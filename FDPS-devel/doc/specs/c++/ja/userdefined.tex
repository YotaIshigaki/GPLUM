\subsection{概要}

本節では、ユーザーが定義するクラスとファンクタについて記述する。ユーザー
定義クラスとなるのは、FullParticleクラス、EssentialParticleIクラス、
EssentialParticleJクラス、Momentクラス、SuperParticleJクラス、Forceクラ
ス、ヘッダクラスである。またユーザー定義の関数オブジェクトには、関数オブジェ
クトcalcForceEpEp、calcForceSpEpがある。

FullParticleクラスは、ある１粒子の情報すべてを持つクラスであり、粒子群
クラスにテンプレート引数として渡されるものである(節
\ref{sec:overview_action}の手順0)。

関数オブジェクトcalcForceEpEpとcalcForceSpEpは、それぞれj粒子からi粒子
への作用を計算する関数オブジェクトと超粒子からi粒子への作用を計算する
関数オブジェクトである。これらは相互作用ツリークラスのAPIの引数として
渡されるものである(節\ref{sec:overview_action}の手順0)。超粒子を必要と
するPS::SEARCH\_MODE型(PS::SEARCH\_MODE\_LONGか
PS::SEARCH\_MODE\_LONG\_CUTOFF)以外を使用する場合には、関数オブジェク
トcalcForceSpEpを定義する必要はない。

EssentialParticleIクラス、EssentialParticleJクラス、Momentクラス、
SuperParticleJクラス、Forceクラスは粒子間の相互作用の定義を補助するも
のである。これらのクラスのうちEssentialParticleIクラス、
EssentialParticleJクラス、Forceクラスはそれぞれ相互作用を計算する際にi
粒子に必要な情報、相互作用を計算する際にj粒子に必要な情報、相互作用の
結果の情報を持つ。これらはFullParticleクラスのサブセットであるため、こ
れらをFullParticleクラスで代用することも可能である。しかし、
FullParticleクラスは相互作用の定義に必要のないデータを多く含む場合も考
えられるため、計算コストを軽減したいならば、これらのクラスを使用するこ
とを検討するべきである。MomentクラスとSuperParticleJクラスは、それぞれ
ツリーセルのモーメント情報を持つクラスと超粒子に必要な情報を持つ
SuperParticleJクラスである。ユーザーが定義する必要があるのは、超粒子を
使う必要がある場合、すなわちPS::SEARCH\_MODE型にPS::SEARCH\_MODE\_LONG
かPS::SEARCH\_MODE\_LONG\_CUTOFFを選んだ場合のみである。

ヘッダクラスは入出力ファイルのヘッダ情報を持つ。

この節で記述するのは、これらのクラスや関数オブジェクトを定義する際の規
定である。ユーザーはこれらの間でのデータのやりとりや、関数オブジェクト
内でのデータの加工についてコードに書く必要がある。これらは上に挙げたク
ラスのメンバ関数と関数オブジェクト内で行われる。以下、必要なメンバ関数
とその規定について記述する。

\subsection{FullParticleクラス}
\label{sec:fullparticle}

\input{userdefined_fullparticle.tex}

\subsection{EssentialParticleIクラス}
\label{sec:essentialparticlei}

\input{userdefined_essentialparticlei.tex}

\subsection{EssentialParticleJクラス}
\label{sec:essentialparticlej}

\input{userdefined_essentialparticlej.tex}

\subsection{Momentクラス}
\label{sec:moment}

\input{userdefined_moment.tex}

\subsection{SuperParticleJクラス}
\label{sec:superparticlej}

\input{userdefined_superparticlej.tex}

\subsection{Forceクラス}
\label{sec:force}

\input{userdefined_force.tex}

\subsection{ヘッダクラス}
\label{sec:userdefined_header}

\input{userdefined_header.tex}

\subsection{関数オブジェクトcalcForceEpEp}
\label{sec:userdefined_calcForceEpEp}

\input{userdefined_calcforceepep.tex}

\subsection{関数オブジェクトcalcForceSpEp}
\label{sec:userdefined_calcForceSpEp}

\input{userdefined_calcforcespep.tex}

\subsection{関数オブジェクトcalcForceDispatch}
\label{sec:userdefined_calcForceDispatch}

\input{userdefined_calcforcedispatch.tex}

\subsection{関数オブジェクトcalcForceRetrieve}
\label{sec:userdefined_calcForceRetrieve}

\input{userdefined_calcforceretrieve.tex}


%\subsection{関数オブジェクトcomp}
%\label{sec:userdefined_comp}
%\input{userdefined_comp.tex}
