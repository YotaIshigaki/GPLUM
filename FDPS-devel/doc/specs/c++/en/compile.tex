\subsection{Summary}

Some of the features of FDPS should be specified at the compile time.
They are (a)coordinate system, (b)method of parallelization, (c)
accuracy of floating point types, (d)maximum-level of tree and
(e)sorting algorithms of particles. In the following we describe how
to specify them.

%% FDPSでは、座標系、並列処理の有無、浮動小数点数型の精度、ツリーの最大の
%% 深さ、粒子ソートのアルゴリズム等を選択できる。この選択はコンパイル時の
%% マクロの定義によってなされる。以下、それぞれの選択の方法を記述する。


\subsection{Coordinate system}
\label{sec:compile_coordinate}

\subsubsection{Summary}

Users have alternatives of 2D and 3D Cartesian coordinate systems.
%%座標系は直角座標系３次元と直角座標系２次元の選択ができる。以下、それ
%%らの選択方法について述べる。

\subsubsection{3D Cartesian coordinate system}

3D Cartesian coordinate system is used by default.
%デフォルトは直角座標系３次元である。なにも行わなくても直角座標系３次元
%となる。

\subsubsection{2D Cartesian coordinate system}

2D Cartesian coordinate system can be used by defining
\texttt{PARTICLE\_SIMULATOR\_TWO\_DIMENSION} as macro.
%コンパイル時にPARTICLE\_SIMULATOR\_TWO\_DIMENSIONをマクロ定義すると直
%交座標系２次元となる。

\subsection{Parallel processing}

\subsubsection{Summary}

Users choose whether OpenMP is used or not, and whether MPI is used or not.
%並列処理に関しては、OpenMPの使用／不使用、MPIの使用／不使用を選択でき
%る。以下、選択の仕方について記述する。

\subsubsection{OpenMP}

OpenMP is disabled by default. If macro
\texttt{PARTICLE\_SIMULATOR\_THREAD\_PARALLEL} is defined, OpenMP becomes
enabled. Compiler option ``-fopenmp'' is required for GCC compiler.
%デフォルトはOpenMP不使用である。使用する場合は、
%\\ PARTICLE\_SIMULATOR\_THREAD\_PARALLELをマクロ定義すればよい。GCCコ
%ンパイラの場合はコンパイラオプションに-fopenmpをつける必要がある。

\subsubsection{MPI}

MPI is disabled by default. If macro
\texttt{PARTICLE\_SIMULATOR\_MPI\_PARALLEL} is defined.
%%デフォルトはMPI不使用である。使用する場合は、
%%PARTICLE\_SIMULATOR\_THREAD\_PARALLELをマクロ定義すればよい。

\subsection{Accuracy of data types}


Users can specify the accuracy of data types of Moment classes described in \S~7.5.2) and SuperParticleJ classes described in \S~7.6.2.

\subsubsection{Accuracy of SuperParticleJ and Moment classes prepared in FDPS}
All the member variables in SuperParticleJ classes and Moment classes
are 64 bit accuracy by default. They becomes 32 bit accuracy if macro
\texttt{PARTICLE\_SIMULATOR\_SPMOM\_F32BIT} is defined at the compile
time.

\subsection{Maximum Tree Level}
\label{sec:compile_tree_level}


Tree structure is constructed by using the Morton keys of the particle
positions and the maximum depth of the tree is determined by the
bit-length of the Morton-key. For 3D simulaitions, users can swich the
bit length (i.e. the maximum depth of the tree). By default the lenght
is 128 bit (the maximum depth is 42). If you specified
PARTICLE\_SIMULATOR\_USE\_96BIT\_KEY or
PARTICLE\_SIMULATOR\_USE\_64BIT\_KEY as macros, the key lenght is 96 or 64 bit
bit (the maximum depths is 31 or 21), respectively.


%ツリー構造は粒子の位置座標のモートンキーを用いて作られているため、ツリー
%の最大レベルはモートンキーのビット長に依存する．FDPSでは3次元シミュレー
%ションの場合にのみ，適切なマクロを指定することにより、粒子のモートンキー
%を64bit(レベル21)，96bit(最大レベル31)，128bit(最大レベル42)の3つから
%選択することができる．特にマクロを指定しなければ，キーの長さは128bitに
%なる．キーを96bitにする場合はPARTICLE\_SIMULATOR\_USE\_96BIT\_KEYを，
%64bitにする場合はPARTICLE\_SIMULATOR\_USE\_64BIT\_KEYをマクロ定義す
%ればよい．

On some machines the use of shorter keys might result in some speedup
and less memory usage. However, in particular in the case of 64-bit
key, the depth of the tree can be insufficient depending on the
distribution and total number of particles.


%% アーキテクチャによっては短いキーとすることで若干の高速化やメモリ節約が
%% 実現できるが、特に64ビットキーでは粒子分布によってはレベルが不足する。

\subsection{Sorting Algorithm of Particles}
\label{sec:compile_sort_method}
\subsubsection{Summary}


In {\tt TreeForForce} class, particles are sorded by Morton
order. Useres can choose the algorithms of the sorting. By default,
the algorithm is parallel merge sort. parallel radix sort  or
parallel sample sort algorithms are  used
when\\
PARTICLE\_SIMULATOR\_USE\_RADIX\_SORT\\
or\\
PARTICLE\_SIMULATOR\_USE\_SAMPLE\_SORT\\
are defined as macro, respectively.

%% {\tt TreeForForce}クラスの内部では粒子はモートンキーの順でソートされて
%% いる．デフォルトでは並列ソートアルゴリズムとしてマージソートが使われている
%% が，PARTICLE\_SIMULATOR\_USE\_RADIX\_SORTをマクロ定義することでソート
%% アルゴリズムを基数ソートに、
%% また、PARTICLE\_SIMULATOR\_USE\_SAMPLE\_SORT をマクロ定義することで
%% 並列サンプルソートに変更できる。


On some machines the radix sort might be faster. On A64fx (Fugaku),
parallel sample sort is much faster than the default merge sort.


%% アーキテクチャによっては基数ソートが若干速いかもしれない。また、 A64fx
%% では並列サンプルソートが速いことが確認されている。
