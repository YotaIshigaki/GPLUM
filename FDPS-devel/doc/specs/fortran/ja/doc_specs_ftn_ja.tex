\documentclass[12pt,a4paper,dvipdfmx]{jbook} % pLaTeX
%%% LaTeXパッケージのインクルード %%%
\usepackage[utf8]{inputenc}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{ascmac}
\usepackage{bm}
\usepackage[x11names,table]{xcolor}
\usepackage{graphicx}
\usepackage{spverbatim} % 折り返し可能なverbを使える
\usepackage{fancyvrb} % verbatim環境の中でitalicを使用するため
\usepackage{wrapfig}
\usepackage{lscape}
\usepackage{setspace}
\usepackage{listings}
\usepackage{here} % 図表をその場に強制的に表示させるため.
\usepackage{hyperref}
\usepackage{pxjahyper}
\usepackage{enumitem}
\usepackage{titlesec}
\usepackage[htt]{hyphenat}
\usepackage[normalem]{ulem}
\usepackage{udline}
\usepackage{fancyhdr}
\usepackage{authblk} % タイトル表示のカスタマイズ
\usepackage{makeidx} % 索引作成
\usepackage{multirow} % 表の行を結合するのに必要
\usepackage{tabularx,booktabs} % 可変サイズの表作成に必要
\usepackage{pdflscape} % Landscape の表の作成のため
\makeindex % 索引作成命令発行

\newcommand{\underbold}[1]{\underline{\bf #1}}
\newcommand{\redtext}[1]{\textcolor{red}{#1}}

%%% ページサイズの設定 %%%
\topmargin=-5mm
\oddsidemargin=-5mm
\evensidemargin=-5mm
\textheight=235mm
\textwidth=165mm

%%% ページのヘッダー・フッターの設定 %%%
% (fancyhdrパッケージが必要)
\pagestyle{fancy}
\lhead{\rightmark}
\chead{}
\rhead{\leftmark}

%%% fancyvrb 環境でitalic体を使用するコマンドを定義 %%%
\newcommand\vrbbf[1]{\textbf{#1}}
\newcommand\vrbit[1]{\textit{#1}}
% <使用方法>
% \begin{Verbatim}[commandchars=\\\{\}]
% \vrbbf{echo foo}
% \vrbit{echo foo} 
% \end{Verbatim}
% ここで、[]のcommandcharsはコマンドに使用する文字列を指定している。
% ここの例だと、\,{,}である。これらの3つの文字の前に\をつけて並べている。
% 詳細は http://tex.stackexchange.com/questions/114942/how-do-i-get-selective-bold-in-verbatim を参照。

%%% カウンター付きのdescription %%%
\newcommand\litem[1]{\item{\bfseries #1\\}}
% <補足>
% 番号はenumerateで生成するので、enumerate環境を使う。
% 番号のスタイルはenumitemパッケージのlabelオプションで変更可能。

%%% subsubsubsection等を定義 %%%
\setcounter{secnumdepth}{5}%
\makeatletter
\newcommand{\subsubsubsection}{\@startsection{paragraph}{4}{\z@}%
{1.5\baselineskip \@plus.5\dp0 \@minus.2\dp0}%
{.5\baselineskip \@plus2.3\dp0}%
{\reset@font\normalsize\bfseries}
}
\newcommand{\subsubsubsubsection}{\@startsection{subparagraph}{5}{\z@}%
{1.5\baselineskip \@plus.5\dp0 \@minus.2\dp0}%
{.5\baselineskip \@plus2.3\dp0}%
{\reset@font\normalsize\itshape}
}
\makeatother
\setcounter{tocdepth}{5}%

%%% footnote の設定 %%%
\renewcommand{\thefootnote}{注\arabic{footnote})}

%%% udline の設定 %%%
%\newcommand{\uwave}[1]{{\setnami\uc{#1}}}
\newcommand{\usaw}[1]{{\setnoko\uc{#1}}}

%%% hyperref 環境の設定 %%%
\hypersetup{%
setpagesize=false,%
bookmarksnumbered=true,%
bookmarksopen=true,%
colorlinks=true,%
linkcolor=blue,%
citecolor=red,%
}%

%%% lstlisting 環境の設定 %%%
\lstdefinelanguage[03fdps]{Fortran}[03]{Fortran}{%
numbers = left,%
numbersep = 8pt,%
numberstyle = \ttfamily\footnotesize,
breaklines = true,%
breakindent = 40pt,%
frame = lines,%
escapeinside={||},%
mathescape=false,%
moredelim=*[directive]\#,%
directives={define,elif,else,endif,error,if,ifdef,ifndef,line,include,pragma,undef,warning},%
basicstyle = \ttfamily\footnotesize,% 基本スタイル
commentstyle=\color[rgb]{0,0,0.8}\ttfamily\footnotesize,% コメント
directivestyle=\color[rgb]{0.83,0.26,0.82}\ttfamily\footnotesize,% マクロ定義
stringstyle=\color[rgb]{0.76,0.22,0.16}\ttfamily\footnotesize,% 文字列
keywordstyle=\color[rgb]{0.05,0.49,0.07}\ttfamily\footnotesize,% void,struct等のキーワード
emph = {c_int,c_short,c_long,c_long_long,c_signed_char,c_size_t,c_int8_t,c_int16_t,c_int32_t,c_int64_t,c_int_least8_t,c_int_least16_t,c_int_least32_t,c_int_least64_t,c_int_fast8_t,c_int_fast16_t,c_int_fast32_t,c_int_fast64_t,c_intmax_t,c_intptr_t,c_float,c_double,c_long_double,c_float_double,c_double_complex,c_long_double_complex,c_bool,c_char,c_null_char,c_alert,c_backspace,c_form_feed,c_new_line,c_carriage_return,c_horizontal_tab,c_vertical_tab,c_null_ptr,c_null_funptr}, %
emphstyle=\color[rgb]{0.83,0.18,0.18}\ttfamily\footnotesize,% その他のキーワード
}[keywords,comments,strings,directives]%
\lstset{%
language = [03fdps]Fortran,%
}

%%% API仕様記述のためのマクロ(牧野さん作成) %%%
\newcommand{\apitop}[1]{
\subsection{#1}
\begin{screen}
}  

\newcommand{\apibottom}[3]{
\end{screen}

\subsubsection*{仮引数仕様}
\begin{table}[H] 
\begin{tabularx}{\linewidth}{cXcX}
\toprule
\rowcolor{Snow2}
仮引数名 & データ型 & 入出力属性 & 定義 \\
\midrule
#1
\bottomrule
\end{tabularx}
\end{table}


% 返り値
\subsubsection*{返り値}
#2


% 機能
\subsubsection*{機能}
#3

}  
\newcommand{\apibottomnoarg}[2]{
\end{screen}

\subsubsection*{仮引数仕様}

なし。
% 返り値
\subsubsection*{返り値}
#1
% 機能
\subsubsection*{機能}
#2

}  

% タイトル、著者、作成日の情報
\title{FDPS Fortran/C言語 インタフェース 仕様書}
\author{行方大輔}
\author{岩澤全規}
\author{似鳥啓吾}
\author{谷川衝}
\author{村主崇行}
\author{Long Wang}
\author{細野七月}
\author{野村昴太郎}
\author{牧野淳一郎}
\affil{理化学研究所 計算科学研究センター 粒子系シミュレータ研究チーム}
\date{}

% 文書の開始
\begin{document}

% タイトルと目次の出力
\maketitle
\tableofcontents

\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{この文書について}
\label{chap:about}
%%%
\section{文書の構成}
\label{sec:structure}
\input{structure.tex}
\newpage
%%%
\section{ライセンス}
\label{sec:license}
\input{license.tex}
\newpage
%%%
\section{ユーザーサポート}
\label{sec:user_support}
\input{user_support.tex}
\newpage


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{FDPS概要}
\label{chap:overview}
\input{overview.tex}
\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Fortran/C言語 インターフェースのファイル構成と概要}
\label{chap:file_str_and_ftn_if_overview}
\input{file_str_and_ftn_if_overview.tex}
\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{FDPSで提供されるデータ型}
\label{chap:data_types}
\input{data_types.tex}
\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{ユーザー定義型・ユーザー定義関数}
\label{chap:user_defined}
\input{user_defined.tex}
\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Fortran/C言語 インターフェースの生成}
\label{chap:script_spec}
\input{script_spec.tex}
\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Fortran/C言語 インターフェースのコンパイル}
\label{chap:compile_and_macro}
\input{compile_and_macro.tex}
\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{API 仕様一覧}
\label{chap:API_spec_list}
この章では、Fortran/C言語 インターフェースの各APIの仕様について記述する。第\ref{chap:file_str_and_ftn_if_overview}章で述べた通り、Fortranでは、各APIは派生データ型\texttt{fdps\_controller}のオブジェクトのメンバ関数として用意されている。以下では、このオブジェクトの名称が\texttt{fdps\_ctrl}であるとして説明を行う。{\setnoko\uc{また、説明を簡略化するため、多くの場合、仮引数のデータ型はFortranの場合のみを示す}}。C言語のデータ型との対応は以下の表\ref{tbl:interoperable_data_types}を参考にして頂きたい。
\clearpage

\begin{table}[H]
\begin{tabularx}{\linewidth}{XX}
\toprule
\rowcolor{Snow2}
Fortranのデータ型 & C言語でのデータ型 \\
\midrule
\texttt{integer(kind=c\_int)}                   & \texttt{int}\\
\texttt{integer(kind=c\_short)}                 & \texttt{short int}\\
\texttt{integer(kind=c\_long)}                  & \texttt{long int}\\
\texttt{integer(kind=c\_long\_long)}            & \texttt{long long int}\\
\texttt{integer(kind=c\_signed\_char)}          & \texttt{signed char/unsigned char}\\
\texttt{integer(kind=c\_size\_t)}               & \texttt{size\_t}\\
\texttt{integer(kind=c\_int8\_t)}               & \texttt{int8\_t}\\
\texttt{integer(kind=c\_int16\_t)}              & \texttt{int16\_t}\\
\texttt{integer(kind=c\_int32\_t)}              & \texttt{int32\_t}\\
\texttt{integer(kind=c\_int64\_t)}              & \texttt{int64\_t}\\
\texttt{integer(kind=c\_int\_least8\_t)}        & \texttt{int\_least8\_t}\\
\texttt{integer(kind=c\_int\_least16\_t)}       & \texttt{int\_least16\_t}\\
\texttt{integer(kind=c\_int\_least32\_t)}       & \texttt{int\_least32\_t}\\
\texttt{integer(kind=c\_int\_least64\_t)}       & \texttt{int\_least64\_t}\\
\texttt{integer(kind=c\_int\_fast8\_t)}         & \texttt{int\_fast8\_t}\\
\texttt{integer(kind=c\_int\_fast16\_t)}        & \texttt{int\_fast16\_t}\\
\texttt{integer(kind=c\_int\_fast32\_t)}        & \texttt{int\_fast32\_t}\\
\texttt{integer(kind=c\_int\_fast64\_t)}        & \texttt{int\_fast64\_t}\\
\texttt{integer(kind=c\_intmax\_t)}             & \texttt{intmax\_t}\\
\texttt{integer(kind=c\_intptr\_t)}             & \texttt{intptr\_t}\\
\texttt{real(kind=c\_float)}                    & \texttt{float}\\
\texttt{real(kind=c\_double)}                   & \texttt{double}\\
\texttt{real(kind=c\_long\_double)}             & \texttt{long double}\\
\texttt{complex(kind=c\_float\_complex)}        & \texttt{float \_Complex}\\
\texttt{complex(kind=c\_double\_complex)}       & \texttt{double \_Complex}\\
\texttt{complex(kind=c\_long\_double\_complex)} & \texttt{long double \_Complex}\\
\texttt{logical(kind=c\_bool)}                  & \texttt{\_Bool}\\
\texttt{character(kind=c\_char)}                & \texttt{char}\\
\bottomrule
\end{tabularx}
\caption{C言語と相互運用可能なFortranのデータ型と対応するC言語のデータ型}
\label{tbl:interoperable_data_types}
\end{table}
\clearpage



%%%
\section{開始および終了処理に関わるAPI}
\label{sec:initfin_APIs}
\input{initfin_APIs.tex}
\newpage
%%%
\section{粒子群オブジェクト用 API}
\label{sec:psys_APIs}
\input{psys_APIs.tex}
\newpage
%%%
\section{領域情報オブジェクト用 API}
\label{sec:dinfo_APIs}
\input{dinfo_APIs.tex}
\newpage
%%%
\section{ツリーオブジェクト用 API}
\label{sec:tree_APIs}
\input{tree_APIs.tex}
\newpage
%%%
\section{通信用 API}
\label{sec:comm_APIs}
\input{comm_APIs.tex}
\newpage
%%%
\section{Particle Mesh用 API}
\label{sec:PM_APIs}
\input{PM_APIs.tex}
\newpage
%%%
\section{その他のAPI}
\label{sec:other_APIs}
\input{other_APIs.tex}
\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{エラーメッセージ}
\label{chap:error_messages}
\input{error_messages.tex}
\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{限界と制約}
\label{chap:limitation}
\input{limitation.tex}
\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{変更履歴}
\label{chap:change_log}
\input{change_log.tex}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 索引
\printindex


\end{document}
