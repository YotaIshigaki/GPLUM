\subsection{概要}

FDPSではのコンパイル時もしくは実行時のエラー検出機能を備えている。ここ
では、FDPSで検出可能なエラーとその場合の対処について記述する。ただし、
ここに記述されていないエラーも起こる可能性がある。（その場合は開発者に
報告していただけると助かります。）

\subsection{コンパイル時のエラー}

\subsection{実行時のエラー}

FDPSが実行時エラーを検出すると標準エラー出力に以下のような書式でメッセー
ジを出力し、PS::Abort(-1)によってプログラムを終了する。

\begin{screen}
  PS\_ERROR: \textit{ERROR MESSAGE}
  
  function: \textit{FUNCTION NAME}, line: \textit{LINE NUMBER}, file:
  \textit{FILE NAME}
\end{screen}

\begin{itemize}
\item \textit{ERROR MESSAGE}

  エラーメッセージ

\item \textit{FUNCTION NAME}

  エラーが起こった関数の名前

\item \textit{LINE NUMBER}

  エラーが起こった行番号
  
\item \textit{FILE NAME}

  エラーが起こったファイルの名前
    
\end{itemize}

以下、FDPSで用意されている実行時エラーメッセージを列挙していく。

\subsubsection{PS\_ERROR: can not open input file}

ユーザーがFDPSのファイル入力関数を使っており、ユーザーが指定した入力ファ
イルがなかった場合に表示される。

エラーメッセージのあとに以下のメッセージも標準エラー出力に表示される。

\begin{screen}
  input file: ``入力ファイル名''
\end{screen}


\subsubsection{PS\_ERROR: can not open output file}

ユーザーがFDPSのファイル出力関数を使っており、ユーザーが指定した出力ファ
イルがなかった場合に表示される。

エラーメッセージのあとに以下のメッセージも標準エラー出力に表示される。

\begin{screen}
  output file: ``出力ファイル名''
\end{screen}


\subsubsection{PS\_ERROR: Do not initialize the tree twice}

同一のツリーオブジェクトに対して関数
{PS::TreeForForce::initialize(...)}を２度呼び出した場合に表示される。
同一のツリーオブジェクトに対して{PS::TreeForForce::initialize(...)}の
呼び出しを一回にする。


\subsubsection{PS\_ERROR: The opening criterion of the tree must be $>=$ 0.0}

長距離力モードでツリーのオープニングクライテリオンに負の値が入力された
場合に表示される。関数{PS::TreeForForce::initialize(...)}を使ってオー
プニングクライテリオンに0以上の値を指定する必要がある。

エラーメッセージのあとに以下のメッセージも標準エラー出力に表示される。

\begin{screen}
  theta\_= ``入力されたオープニングクライテリオンの値''

  SEARCH\_MODE: ``対象となるツリーのサーチモードの型名''

  Force: ``対象となるツリーのフォースの型名''

  EPI: ``対象となるツリーのEPIの型名''

  EPJ: ``対象となるツリーのEPJの型名''

  SPJ: ``対象となるツリーのSPJの型名''
  
\end{screen}

\subsubsection{PS\_ERROR: The limit number of the particles in the leaf cell must be $>$ 0}

長距離力モードでツリーのリーフセルの最大粒子数に負の値が入力された場合
に表示される。関数{PS::TreeForForce::initialize(...)}を使ってリーフセ
ルの最大粒子数に正の整数を指定する必要がある。

エラーメッセージのあとに以下のメッセージも標準エラー出力に表示される。

\begin{screen}
  n\_leaf\_limit\_=''入力されたリーフセルの最大粒子数''

  SEARCH\_MODE: ``対象となるツリーのサーチモードの型名''

  Force: ``対象となるツリーのフォースの型名''

  EPI: ``対象となるツリーのEPIの型名''

  EPJ: ``対象となるツリーのEPJの型名''

  SPJ: ``対象となるツリーのSPJの型名''
  
\end{screen}

\subsubsection{PS\_ERROR: The limit number of particles in ip groups msut be $>=$ that in leaf cells}

長距離力モードでツリーのリーフセルの最大粒子数がi粒子グループの粒子の
最大数より大きかった場合に表示される。関数
{PS::TreeForForce::initialize(...)}を使ってi粒子グループの最大粒子数を
リーフセルの最大粒子数以上にする必要がある。

エラーメッセージのあとに以下のメッセージも標準エラー出力に表示される。

\begin{screen}
  n\_leaf\_limit\_=''入力されたリーフセルの最大粒子数''

  n\_grp\_limit\_=''入力されたi粒子グループの内の最大粒子数''

  SEARCH\_MODE: ``対象となるツリーのサーチモードの型名''

  Force: ``対象となるツリーのフォースの型名''

  EPI: ``対象となるツリーのEPIの型名''

  EPJ: ``対象となるツリーのEPJの型名''

  SPJ: ``対象となるツリーのSPJの型名''
  
\end{screen}

\subsubsection{PS\_ERROR: The number of particles of this process is beyond the FDPS limit number}

FDPSでは1プロセスあたりに扱える粒子数は2G(G=$2^{30}$)であり、それ以上の
粒子を確保しようとした場合に表示される。この場合、プロセス数を増やすな
どして、1プロセスあたりの粒子数を減らす必要がある。

\subsubsection{PS\_ERROR: The forces w/o cutoff can be evaluated only under the open boundary condition}

開放境界以外の条件下でカットオフなし長距離力を設定した場合に表示される。
カットオフなし長距離力の計算では必ず、開放境界条件を使う。無限遠までの
粒子からの力を計算したい場合はカットオフあり長距離力の計算をFDPSで行い、
カットオフ外からの力の計算は外部モジュールであるParticle Meshを使う事
ができる。

\subsubsection{PS\_ERROR: A particle is out of root domain}

ユーザーが\textit{PS::DomainInfo::setRootDomain(...)}関数を用いてルー
トドメインを設定しており、粒子がそのルートドメインからはみ出していた場
合に表示される。周期境界条件の場合はユーザーは粒子をルートドメイン内に
収まるように位置座標をシフトする必要がある。FDPSでは粒子をルートドメイ
ン内にシフトする関数\\
\textit{PS::ParticleSystem::adjustPositionIntoRootDomain(...)}を用意し
ており、それを使うこともできる。

エラーメッセージのあとに以下のメッセージも標準エラー出力に表示される。

\begin{screen}
  position of the particle=''粒子の座標''

  position of the root domain=''ルートドメインの座標''
\end{screen}


\subsubsection{PS\_ERROR: The smoothing factor of an exponential moving average is must between 0 and 1.}

ユーザーがPS::DomainInfo::initialize(...)関数を用いて平滑化係数に0未満
もしくは1を超える値を設定した場合に表示される。エラーメッセージのあと
に以下のメッセージも標準エラー出力に表示される。

\begin{screen}
  The smoothing factor of an exponential moving average=''平滑化係数の値''
\end{screen}

\subsubsection{PS\_ERROR: The coodinate of the root domain is inconsistent.}

ユーザーがPS::DomainInfo::setPosRootDomain(...)関数を用いてルートドメ
インを設定した時に、ユーザーが設定した小さい側の頂点の座標の任意の成分
が大きい側の頂点の対応する座標の値よりも大きかった場合に表示される。エ
ラーメッセージのあとに以下のメッセージも標準エラー出力に表示される。

\begin{screen}
  The coordinate of the low vertex of the rood domain=''小さい側の頂点の座標''
  
  The coordinate of the high vertex of the rood domain=''大きい側の頂点の座標''  
\end{screen}

%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsection{PS\_ERROR: Vector invalid accesse}
\label{sec:errormessage:vector_invalid_access}

%コンパイル時にARTICLE\_SIMULATOR\_VECTOR\_RANGE\_CHECKをマクロ定義して
%おり、さらに{\tt Vector}型の{\tt []}演算子で定義されている範囲外の成分
%にアクセスを行った場合に表示される。エラーメッセージのあとに以下のメッ
%セージも標準エラー出力に表示される。

{\tt Vector}型の{\tt []}演算子で定義されている範囲外の成分にアクセスを
行った場合に表示される。エラーメッセージのあとに以下のメッセージも標準
エラー出力に表示される。

\begin{screen}
  Vector element=''指定した成分'' is not valid
\end{screen}
