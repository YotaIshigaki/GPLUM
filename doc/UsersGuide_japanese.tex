%\documentclass[12pt,a4paper,dvipdfmx, titlepage]{jsarticle}
\documentclass[12pt,a4paper,dvipdfmx]{jsarticle}
\usepackage{amsmath,amssymb}
\usepackage[deluxe]{otf}
\usepackage{newtxtext}
\usepackage{bm}
\usepackage{fancybox}
\usepackage{ascmac}
\usepackage{ulem}
\usepackage{booktabs}
%\usepackage{pict2e}
\usepackage{graphicx,color}
\usepackage{tcolorbox}
\usepackage{indentfirst}
\usepackage{xspace}
\usepackage[dvipdfm,
    top=3truecm,
    bottom=3truecm,
    left=3truecm,
    right=3truecm]{geometry}
\usepackage[deluxe]{otf}
\usepackage{titlesec}
\usepackage{lscape}
\usepackage[cc]{titlepic}
\tcbuselibrary{raster,skins}
\tcbuselibrary{breakable}
\tcbuselibrary{skins} %preamble
%\setlength{\textwidth}{\fullwidth}
\setlength{\evensidemargin}{\oddsidemargin}

\title{\ourcode ユーザーズガイド}
%\author{石城陽太}
\author{石城陽太，小南淳子，牧野淳一郎，藤本正樹，岩澤全規}
\titlepic{
\vspace{25mm}
\includegraphics[width=6.5cm]{GPLUM_logo.pdf}
\vspace{25mm}
}

\newcommand{\ourcode}{GPLUM\xspace}
\newcommand{\ourcodeR}{GPLUM-2.5\xspace}
%\pagestyle{empty}
\begin{document}
%\maketitle

　\vspace{5mm}

\begin{center}
\hspace{27mm} {\huge \ourcode ユーザーズガイド}

\vspace{7mm}

\hspace{39mm} {\large 石城陽太，小南淳子，牧野淳一郎，藤本正樹，岩澤全規}
\end{center}

\begin{flushleft}
\vspace{-27mm}
\hspace{1mm} \includegraphics[width=4cm]{GPLUM_logo.pdf}
\end{flushleft}

\vspace{15mm}


\tableofcontents

%\vspace{90mm}

%\begin{figure}[h]
%\begin{center}
%\includegraphics[width=4.5cm]{GPLUM_logo.png}
%\end{center}
%\end{figure}

\newpage

\section{GPLUMの概要}

\ourcode は ${\rm P^{3}T}$法 (Oshino et al. 2011)を用いた惑星系形成N体計算用コードです．
\ourcode はFDPS (Iwasawa et al. 2016) を使用しています．
現在の最新バージョンは\ourcodeR です．\ourcodeR はFDPS-7.0での動作確認をしています．


\section{ダウンロード}
\ourcode のソースコードは\textcolor{blue}{https://github.com/YotaIshigaki/GPLUM}からダウンロードできます．

以下を実行して，\ourcode をダウンロードしてください．
\begin{verbatim}
$ git clone --recursive https://github.com/YotaIshigaki/GPLUM.git
\end{verbatim}

%さらに，ダウンロードされた\ourcode のディレクトリに移動して，以下を実行して，PIKG，FDPSをダウンロードしてください．
%\footnote{
%現在，領域の極座標分割は公開版のFDPSでは対応していません(Section \ref{s:error}参照)．領域の極座標分割を使用する場合は，FDPSの開発版にアクセス可能であれば，以下を実行して，FDPSの開発版をダウンロードして使用してください．
%\begin{verbatim}
%$ git clone -b makinotest https://github.com/FDPS/fdps-devel.git
%\end{verbatim}
%}
%\begin{verbatim}
%$ git clone https://github.com/FDPS/PIKG.git
%$ git clone https://github.com/FDPS/FDPS.git
%\end{verbatim}


\section{ファイル構成}

\subsection{ドキュメント}
ドキュメント関係のファイルはディレクトリ\texttt{doc}にあります．
\texttt{UsersGuide\_japanese.pdf}が日本語のユーザーズガイドです．
英語のユーザーズガイドは準備中です．

\subsection{ソースファイル}
ソースファイルは，ディレクトリ\texttt{src}にあります．

\subsection{サンプルファイル}
サンプルファイルは，ディレクトリ\texttt{sample}にあります．
以下で，サンプルファイルの説明をします．
\subsubsection{初期条件ファイル}
\texttt{INIT3000.dat}は，初期条件ファイルのサンプルファイルです．
1行目にヘッダー，2行目以降に粒子の情報が記述されています．
初期条件ファイルの形式については，Section \ref{outputene} を参照してください．

\subsubsection{パラメータファイル}
\texttt{parameter.dat}は，パラメータファイルのサンプルファイルです．
設定できるパラメータについては，Section \ref{parameter}を参照してください．

\subsection{解析用ソースファイル}
結果の作図などに用いるソースファイルのサンプルファイルは，ディレクトリ\texttt{analysis}にあります．
使用方法は，ソースファイルのドキュメンテーションを参照してください．

\subsection{FDPS，PIKG}
FDPSやPIKGについては，それぞれの仕様書を参照してください．



\section{コンパイルと実行}

\subsection{Makefileの設定}

\texttt{src/Makefile}で，コンパイラやオブションの設定ができます．

\subsubsection{コンパイラ}
\texttt{src/Makefile}の\texttt{CC}でコンパイラを指定します．
%\ourcodeR は，GNU version 7.3.0での動作確認をしています．

\subsubsection{オプション}
\texttt{src/Makefile}の\texttt{CFLAGS}でオプションを指定します．
以下で，指定できるオプションを説明します．

\begin{description}
\item[MPI]
MPIはデフォルトでは不使用です．MPIを使用するには，
%\texttt{-DPARTICLE\_SIMULATOR\_MPI\_PARALLEL}を有効にしてください．
\texttt{use\_MPI}をyesにしてください．

\item[OpneMP]
OpenMPはデフォルトでは不使用です．OpenMPを使用するには，
%\texttt{-DPARTICLE\_SIMULATOR\_THREAD\_PARALLEL}と\texttt{-fopenmp}を有効にしてください．
\texttt{use\_OpenMP}をyesにしてください．

\item[SIMD命令]
SIMD命令はデフォルトでは不使用です．
SIMD命令 は，AVX2 または AVX512DQ が使用可能です．
使用する場合は，\texttt{use\_AVX2}または\texttt{use\_AVX-512}をyesにしてください．
%いずれかに対応するオプションを有効にしてください．
AVX2，AVX-512に対応するオプションは，Makefileの62行目，67行目で設定されています．
オプションの内容を変更する場合は書き換えてください．
SIMD命令に関するオプションについて，詳しくは，使用するコンパイラのマニュアルを参考にして下さい．

\item[カットオフ半径]
カットオフは，デフォルトでは共有カットオフが使用されます．
独立カットオフを使用する場合は，%\texttt{-DUSE\_INDIVIDUAL\_CUTOFF}を有効にしてください.
\texttt{individual\_cutoff}をyesにしてください．


\item[ツリーの多重極展開]
ツリーの多重極展開は，デフォルトでは単極子までです．
四重極子まで展開する場合は， %\texttt{-DUSE\_QUAD}を有効にしてください.
\texttt{quad}をyesにしてください．

\item[領域分割]
領域分割は，デフォルトではデカルト座標系を使用します．
領域分割に極座標を使用する場合は，
\texttt{use\_polar\_coordinate}をyesにしてください．


\item[ランダム速度]
粒子のランダム速度は，デフォルトではKepler速度との差として定義されます．
粒子が等方的に運動している系を扱う場合は，%\texttt{-DISOTROPIC}を有効にしてください．
\texttt{isotropic}をyesにしてください．
ランダム速度の計算方法については，Section \ref{paramg}を参照してください．

\item[ガス抵抗]
デフォルトではガス抵抗はありません．
ガス抵抗を考慮する場合は，%\texttt{-DGAS\_DRAG}を有効にしてください．
\texttt{gas\_drag}をyesにしてください．
ガス抵抗は，Adachi et al. (1976)のモデルを使用します．


\item[Hermite法の精度]
デフォルトではHard partの中心星相互作用，粒子間重力相互作用は4次Hermite法で積分されます．
中心星重力相互作用を6次Hermite法で積分する場合は，%\texttt{-DINTEGRATE\_6TH\_SUN}を有効にしてください．
\texttt{integrate\_6th}をyesにしてください．

\item[衝突判定]
粒子同士の衝突判定は，デフォルトでは行われません．
衝突判定を行う場合は，%\texttt{-DCOLLISION}を有効にしてください.
\texttt{collision}をyesにしてください．

\item[衝突合体/破壊モデル]
衝突判定を行う場合，デフォルトでは完全合体モデルが使用されます．
%\texttt{-DKOMINAMI}を有効にすると，
\texttt{Kominami}をyesにすると，
Kominami et al. (in prep.)の衝突破壊モデルを使用します．
%\texttt{-DCHAMBERS}を有効にすると，
\texttt{Chambers}をyesにすると，
Chambers (2013)の衝突破壊モデルを使用します．
%\texttt{-DKOMINAMI}と\texttt{-DCHAMBERS}が両方とも有効にされた場合は，Kominami et al. (2019, in prep.)のモデルが使用されます．
それ以外の衝突破壊モデルを使用する方法については，Section \ref{collision}を参照してください．

\item[連微惑星の結合]
連微惑星が形成されたとき，それらをまとめて1つの超粒子にする処理を行う場合は，
%\texttt{-DMERGE\_BINARY}を有効にしてください．
\texttt{merge\_binary}をyesにしてください．


\item[出力]
%\texttt{-DOUTPUT\_DETAIL}を有効にすると，
\texttt{output\_detail}をyesにすると，
出力ファイルに出力される内容が増えます．詳細はSection \ref{outputene}を参照してください．

%\item[テスト粒子]
%テスト粒子(質量が0の粒子)が存在すると，FDPSが異常終了することがあります．
%\texttt{-DTEST\_PTCL}を有効にすると，テスト粒子の質量にdouble型の数値的な最小値を設定することで異常終了を防ぎます．テスト粒子同士の相互作用は，Hard partでは計算されません．

%\item[その他]
%FDPSの開始メッセージにモナーのアスキーアートを表示する場合は，マクロ\texttt{MONAR}を定義してください．
%実行時の引数に\texttt{monar}または\texttt{MONAR}を指定すると，FDPSの開始メッセージにモナーのアスキーアートが表示されます．

\end{description}

\subsubsection{FDPS}
\texttt{src/Makefile}の\texttt{PS\_PATH}でFDPSの\texttt{src}ディレクトリにパスを設定します．
FDPSの他のバージョンを用いる場合は，FDPSをダウンロードし，同様にそのFDPSの\texttt{src}ディレクトリにパスを設定してください．


\subsection{コンパイル\label{compile}}

コンパイルするには，ディレクトリ\texttt{\ourcode /src} に移動し，以下のコマンドを実行してください．
\begin{verbatim}
$ make
\end{verbatim}
ディレクトリ\texttt{\ourcode /src}に実行ファイル\texttt{gplum.out}が作成されます．



\subsection{実行}

計算を実行するディレクトリに実行ファイル\texttt{gplum.out}とパラメータファイルを移動し，以下のように実行してください．
MPI並列化を行う場合は，使用する環境のマニュアルを参照してください．
\begin{verbatim}
$ ./gplum.out
\end{verbatim}
%\begin{verbatim}
%$ mpirun -n (プロセス数) gplum.out
%\end{verbatim}
カレントディレクトリに出力ディレクトリが作成され，出力ディレクトリに結果が出力されます．出力の形式については，Section \ref{output}を参照してください．

以下で，実行時に指定できるオプションを説明します．
同じパラメータを，実行時のオプションとパラメータファイルの両方で設定した場合，実行時のオプションの設定が優先されます．

\begin{description}
\item[\texttt{-p}:]
パラメータファイルを指定します．このオプションを指定しない場合は，パラメータファイルは\texttt{parameter.dat}となります．\texttt{parameter.dat}というファイル名以外のパラメータファイルを用いる場合に指定してください．
\item[\texttt{-r}:]
計算を再スタートするときに指定してください．このオプションを指定すると，出力ディレクトリにあるスナップショットファイルの中で番号が最も大きいファイルから初期条件を読み込み，計算をスタートします．
\item[\texttt{-i}:]
初期条件ファイルを指定します．
\item[\texttt{-s}:]
初期条件の作成や，衝突破壊モデルで用いられる乱数のシードを指定します．
\item[\texttt{-e}:]
実計算時間の上限を指定します．計算時間がこの時間を超えた場合，パラメータファイルで設定している終了条件を無視して終了処理に移行します．単位は時間です．
\item[\texttt{-o}:]
出力ディレクトリ名を指定します．
このオプションで設定した名前のディレクトリに計算結果が出力されます．その名前のディレクトリが実行ディレクトリにない場合は，その名前のディレクトリが作成されます．
\item[\texttt{-D}:]
ツリーのタイムステップ$\Delta t_{\rm tree}$を整数で指定します．このオプションで指定した整数を$n$とすると，ツリーのタイムステップは$\Delta t_{\rm tree}=2^{-n}$となります．
\item[\texttt{-R}:]
粒子のカットオフ半径を決めるパラメータ$\tilde{R}_{\rm cut,0}$を指定します．
\item[\texttt{-S}:]
粒子のカットオフ半径を決めるパラメータ$\tilde{R}_{\rm cut,1}$を指定します．
%ここで$\tilde{R}_{\rm cut}$を指定すると，探索半径を決めるパラメータ$\tilde{R}_{\rm search0}$が1に設定されます．

$\tilde{R}_{\rm cut,0},\ \tilde{R}_{\rm cut,1}$について，詳しくはSection \ref{paramg}を参照してください．
\item[\texttt{-x}:]
$x$方向のルートドメインの分割数を指定します．
\item[\texttt{-y}:]
$y$方向のルートドメインの分割数を指定します．

領域分割については，FDPSのマニュアルも参照してください．


\end{description}

  
\section{入力パラメータ\label{parameter}}

以下で，パラメータファイルで設定できるパラメータを説明します．
距離，質量，時間の単位は，それぞれ${\rm AU},\ M_{\odot},\ {\rm year}/2\pi$です．
値の末尾に\texttt{MKS}や\texttt{CGS}とつけると，それぞれMKS単位系，CGS単位系の値で記述することができます．例えば，密度の次元を持つパラメータの値として\texttt{2.0CGS}と記述すると，$2.0\ {\rm g/cm^{3}}$が$M_{\odot}/{\rm AU^{3}}$の単位に変換されて設定されます．
以下の各項目の(\ )の値は，パラメータが設定されなかった場合に設定されるデフォルト値です．

\subsection{ランダムシード}
\begin{description}
\item[\texttt{seed}:]
ランダムシード\ (1)．初期条件の作成や，衝突破壊モデルで用いられる乱数のシードです．
\end{description}

\subsection{入力・出力}
\begin{description}
\item[\texttt{Init\_file}:]
初期条件ファイル名(INIT\_3000.dat)．初期条件ファイルの形式は，Section \ref{snap}で説明します．
\item[\texttt{Header}:]
初期条件ファイルにヘッダがある場合に$1$，ヘッダがない場合に$0$を設定します(0)．
ヘッダの形式は，Section \ref{snap}で説明します．
ヘッダがない場合，時刻は$0$となり，粒子数やエネルギーは初期条件ファイルから計算されます．
\item[\texttt{output\_dir}:]
出力ディレクトリ名(OUTPUT)．ここで設定した名前のディレクトリに計算結果が出力されます．その名前のディレクトリがカレントディレクトリにない場合は，その名前のディレクトリが作成されます．
\item[\texttt{Restart}:]
計算を再スタートさせる場合は$1$，そうでない場合には$0$を設定します(0)．
この値に$1$を設定すると，
%出力ディレクトリにあるスナップショットファイルの中で番号が最も大きいファイルから初期条件を読み込み，
出力ディレクトリの再計算用の出力(\texttt{snap\_temp.dat})から初期条件を読み込み，
計算をスタートします．

\end{description}

\subsection{微惑星円盤の初期条件}
初期条件ファイルから初期条件を読み込む場合には使われません．
微惑星円盤の面密度$\Sigma_{\rm d}$が，
\begin{equation}
\Sigma_{\rm d}=
\begin{cases}
10f_{\rm d}\left( \displaystyle\frac{r}{1\ {\rm AU}} \right)^{-p}\ {\rm g/cm^{-2}} & (r \leq  a_{\rm ice})\\
10f_{\rm d}\eta_{\rm ice}\left( \displaystyle\frac{r}{1\ {\rm AU}} \right)^{-p}\ {\rm g/cm^{-2}} & (r > a_{\rm ice})
\end{cases}
\label{sigmad}
\end{equation}
と表されるモデルを使用します(Hayashi 1981)．$r$は中心星からの距離です．

\begin{description}
\item[\texttt{makeInit}:]
粒子の初期条件をプログラム内で作成する場合に$1$，ファイルから読み込む場合に$0$を設定します(0)．
この値に$1$を設定すると，初期条件ファイルが設定されていても，プログラム内で粒子の初期条件を作成します．

\item[\texttt{n\_init}:]
初期粒子数$n_{\rm init}$\ (0)．
\item[\texttt{m\_init}:]
初期粒子質量$m_{\rm init}$\ (0.0)．
$n_{\rm init}$，$m_{\rm init}$のどちらか片方が指定された場合，(\ref{sigmad})に従うようにもう一方の値が設定され，
(\ref{sigmad})の分布に従って粒子が配置されます．
どちらも指定された場合は，設定された$f_{\rm d}$の値に関わらず，(\ref{sigmad})に従うように$f_{\rm d}$の値を調整して粒子が配置されます．
どちらも指定されない場合は，エラーとなります．

\item[\texttt{p}:]
$\Sigma_{\rm d}$の$r$についての冪$p$\ (1.5)．
\item[\texttt{f\_dust}:]
$\Sigma_{\rm d}$のスケーリングファクター$f_{\rm d}$\ (0.71)．
\item[\texttt{eta\_ice}:]
雪線の外側領域における雪線境界ファクター$\eta_{\rm ice}$\ (4.2)．
\item[\texttt{a\_in}:]
初期微惑星が配置される領域の内側境界$a_{\rm in}$\ (0.98)．
\item[\texttt{a\_out}:]
初期微惑星が配置される領域の外側境界$a_{\rm out}$\ (1.02)．
\item[\texttt{a\_ice}:]
雪線の半径$a_{\rm ice}$\ (2.0)．
\end{description}

\subsection{ガス円盤}
コンパイルオプションで\texttt{-DGAS\_DRAG}が有効になっていない場合には使用されません．
ガス円盤の面密度$\Sigma_{\rm g}$は，
\begin{equation}
\Sigma_{\rm g}=2400f_{\rm g}\left( \frac{a}{1\ {\rm AU}} \right)^{-p}\ {\rm g/cm^{-2}}\label{sigmag}
\end{equation}
のように表され，ガス密度$\rho_{\rm g}$，円盤温度$T$が，
\begin{align}
\rho_{\rm g}&=1.4\times 10^{-9}\ f_{\rm g}\left( \frac{r}{1\ {\rm AU}} \right)^{-\alpha}\ {\rm g/cm^{-3}}\\
T&=2.8\times 10^{2}\ \left( \frac{r}{1\ {\rm AU}} \right)^{-\beta}\ {\rm K}
\end{align}
のように表されるモデルを使用します(Hayashi 1981)．$r$は中心星からの距離です．
ガス抵抗は，Adachi et al. (1976)のモデルを使用します．

\begin{description}
\item[\texttt{alpha\_gas}:]
$\rho_{\rm g}$の$r$についての冪$\alpha$\ (11.0/4.0)．
\item[\texttt{beta\_gas}:]
$T$の$r$についての冪$\beta$\ (0.5)．
\item[\texttt{f\_gas}:]
$\Sigma_{\rm g}$のスケーリングファクター$f_{\rm g}$\ (0.71)．
\item[\texttt{tau\_gas}:]
ガス円盤の散逸時定数$\tau_{\rm g}$\ (0)．
この値を$0$以外に設定すると，$\rho_{\rm g}$が$\exp(-t/\tau_{\rm gas})$に従って変化します．$t$は系の時刻です．
この値を$0$に設定すると，$\rho_{\rm g}$は時間変化しません．
\item[\texttt{C\_d}:]
無次元のガス抵抗係数$C_{\rm D}$\ (1.0)．
\item[\texttt{mu}:]
ガスの平均分子量$\mu$\ (2.34)．
\end{description}

\subsection{領域分割}
\begin{description}
\item[\texttt{coef\_ema}:]
領域分割の指数移動平均の平滑化係数(0.3)．
\item[\texttt{nx},\texttt{ny}:]
$x,y$方向のルートドメインの分割数$n_{x},\ n_{y}$\ ($n_{x}n_{y}$がMPIプロセス数となる整数)．
極座標系を使用して分割する場合は，それぞれ$\theta,\, r$方向のルートドメインの分割数となります．

領域分割については，FDPSのマニュアルも参照してください．
\item[\texttt{reset\_step}:]
領域分割をやり直すステップの間隔(1024)．%粒子の削除や
カットオフ半径の再設定もこの間隔で行われます．
\end{description}

\subsection{ツリー}
\begin{description}
\item[\texttt{theta}:]
ツリーの見込み角$\theta$\ (0.5)．
\item[\texttt{n\_leaf\_limit}:]
ツリーを切るのをやめる粒子数の上限(8)．
\item[\texttt{n\_group\_limit}:]
相互作用リストを共有する粒子数の上限(256)．
\end{description}

\subsection{タイムステップ\label{timestep}}
\begin{description}
\item[\texttt{t\_end}:]
プログラムを終了する系の時刻$t_{\rm end}$\ (1.0)．
\item[\texttt{dt\_tree}:]
ツリーのタイムステップ$\Delta t_{\rm tree}$\ (1/32)．2の冪乗でなければなりません．
\item[\texttt{dt\_snap}:]
出力の時間間隔$\Delta t_{\rm snap}$\ (1/32)．$\Delta t_{\rm tree}$の整数倍でなければなりません．
\item[\texttt{dt\_snap\_tmp}:]
再計算用のファイル出力の時間間隔$\Delta t_{\rm snap}$\ (1/32)．$\Delta t_{\rm tree}$の整数倍でなければなりません．
\item[\texttt{dt\_min}:]
Hermite法におけるタイムステップの最小値$\ \Delta t_{\rm min}$\ (1/8192)．2の冪乗でなければなりません．また，$\Delta t_{\rm min}<0.5\Delta t_{\rm tree}$でなければなりません．
\item[\texttt{eta},\ \texttt{eta\_sun}:]
Hermite法におけるタイムステップを決めるパラメータ$\eta,\ \eta_{\rm sun}$\ (0.01,\ 0.01)．
\item[\texttt{eta\_0},\ \texttt{eta\_sun0}:]
Hermite法における初期タイムステップを決めるパラメータ$\eta_{0},\ \eta_{\rm sun, 0}$\ (0.001,\ 0.001)．
\item[\texttt{alpha}:]
Hermite法におけるタイムステップを決めるパラメータ$\alpha$\ (1.0)．

Hermite法において，次ステップのタイムステップは，以下を基準に2の冪乗で設定されます．
\begin{equation}
\Delta t^{*} = \min\left(
\eta\sqrt{\frac{\sqrt{|\bm{a}_{\rm int}|^{2}+\alpha^{2}{a_{0}}^{2}}|\bm{s}_{\rm int}|+|\bm{j}_{\rm int}|^{2}}{|\bm{j}_{\rm int}||\bm{c}_{\rm int}|+|\bm{s}_{\rm int}|^{2}}},\ 
\eta_{\rm sun}\sqrt{\frac{|\bm{a}_{\rm sun}||\bm{s}_{\rm sun}|+|\bm{j}_{\rm sun}|^{2}}{|\bm{j}_{\rm sun}||\bm{c}_{\rm sun}|+|\bm{s}_{\rm sun}|^{2}}}
\right).
\end{equation}
$\bm{a},\ \bm{j},\ \bm{s},\ \bm{c}$は粒子のHardの加速度，加速度の1階,2階,3階時間微分で，添字 int は粒子間相互作用を，sunは中心星との相互作用を表します．
$a_{0}$は近接粒子との相互作用によるカットオフされない加速度の大きさで，近接粒子が複数ある場合はその平均です．
ただし，初期タイムステップや衝突直後のタイムステップは，以下を基準に2の冪乗で設定されます．
\begin{equation}
\Delta t^{*} = \min\left(
\eta_{0}\frac{\sqrt{|\bm{a}_{\rm int}|^{2}+\alpha^{2}{a_{0}}^{2}}}{|\bm{j}_{\rm int}|},\ 
\eta_{\rm sun, 0}\frac{|\bm{a}_{\rm sun}|}{|\bm{j}_{\rm sun}|}
\right).
\end{equation}


\end{description}



\subsection{重力相互作用\label{paramg}}

\begin{description}
\item[\texttt{m\_sun}:]
中心星質量$m_{\rm Sun}$\ (1.0)．
\item[\texttt{dens}:]
粒子平均密度$\rho_{\rm planet}$\ ($5.049667\times 10^{6}$)．
初期条件ファイルから初期条件を読み込まない場合，または初期条件ファイルの$r_{\rm planet}$が0に設定されている場合に，平均密度を用いて粒子半径を設定します．
初期条件ファイルにおいて$r_{\rm planet}$が0以上の値で設定されている場合は使用されません．
\item[\texttt{eps}:]
重力のソフトニングパラメータ$\epsilon$\ ($0.0$)．
\item[\texttt{r\_cut\_max},\ \texttt{r\_cut\_min}:]
カットオフ半径の最大値$r_{\rm cut,max}$，最小値$r_{\rm cut,min}$\ (0.0, 0.0)．

\item[\texttt{p\_cut}:]
カットオフ半径の軌道長半径についての冪$p_{\rm cut}$\ (0.0)．

\item[\texttt{R\_cut0},\ \texttt{R\_cut1}:]
粒子のカットオフ半径を決めるパラメータ$\tilde{R}_{\rm cut,0},\ \tilde{R}_{\rm cut,1}$\ (2.0, 4.0)．

\item[\texttt{R\_search0},\ \texttt{R\_search1}:]
粒子の探索半径を決めるパラメータ$\tilde{R}_{\rm search,0},\tilde{R}_{\rm search,1}$\ (1.0,1.0)．
$\tilde{R}_{\rm search0}\geq 1$でなければなりません．

\item[\texttt{R\_search2},\ \texttt{R\_search3}:]
粒子の探索半径を決めるパラメータ$\tilde{R}_{\rm search,2},\tilde{R}_{\rm search,3}$\ (1.0,4.0)．
$\tilde{R}_{\rm search,2}\geq 1$でなければなりません．
%コンパイルオプションで\texttt{-DUSE\_RE\_SEARCH\_NEIGHBOR}が有効になっていない場合には使用されません．

%\item[\texttt{rHill\_min}:]
%カットオフ半径，探索半径の設定に用いられるHill半径$r_{\rm Hill}$の最小値$r_{\rm Hill,min}$\ (0.0)．

粒子$i$の外側カットオフ半径$r_{{\rm out},i}$は，
$r_{\rm cut,max}>0$のとき，
\begin{equation}
r_{{\rm out},i}=\begin{cases}
r_{\rm cut,max} & \left(r_{\rm cut,max}\leq r_{{\rm out},i}^{*}\right)\\
r_{{\rm out},i}^{*} & \left(r_{\rm cut,min}\leq r_{{\rm out},i}^{*} < r_{\rm cut,max}\right)\\
r_{\rm cut,min} & \left( r_{{\rm out},i}^{*} < r_{\rm cut,min}\right)
\end{cases}\label{rHill1},
\end{equation}
$r_{\rm cut,max}=0$のとき，
\begin{equation}
r_{{\rm out},i}=\max(r_{{\rm out},i}^{*},\ r_{\rm cut,min})\label{rHill2}
\end{equation}
と設定されます．ここで，$r_{{\rm out},i}^{*}$は，
\begin{align}
r_{{\rm out},i}^{*}&=\max\left(\tilde{R}_{\rm cut,0}\left(\frac{a_{i}}{1\ {\rm AU}}\right)^{-p_{\rm cut}}r_{{\rm Hill},i},
\tilde{R}_{\rm cut,1}v_{{\rm ran},i}\Delta t_{\rm tree}\right)\\
r_{{\rm Hill},i}&=\left(\displaystyle\frac{m_{i}}{3M_{\odot}}\right)^{1/3}a_{i}
\end{align}
となります．
%粒子$i$のHill半径は
%\begin{equation}
%r_{{\rm Hill},i}=\left(\displaystyle\frac{m_{i}}{3M_{\odot}}\right)^{1/3}a_{i}
%\end{equation}
%と設定されます．
$m_{i},\ a_{i}$はそれぞれ粒子$i$の質量，軌道長半径，
$v_{{\rm ran},i}$は粒子$i$の周囲の粒子のランダム速度の平均です．
粒子の軌道離心率が$0.6$以上の場合は，$a_{i}$の代わりに中心星からの距離が使用されます．

粒子$i,j$の相互作用についての外側カットオフ半径$r_{{\rm out},ij}$は，
共有カットオフ半径の場合，
\begin{equation}
r_{{\rm out},ij}=\max_{k}(r_{{\rm out},k})\label{rout1}
\end{equation}
独立カットオフ半径の場合，
\begin{equation}
r_{{\rm out},ij}=\max(r_{{\rm out},i}, r_{{\rm out},j})\label{rout2}
\end{equation}
と設定されます．

粒子$i$の探索半径$r_{{\rm search},i}$は，
\begin{equation}
r_{{\rm search},i}=\tilde{R}_{\rm search,0}r_{{\rm out},i}+\tilde{R}_{\rm search,1}v_{{\rm ran},i}\Delta t_{\rm tree}\label{rsearch}
\end{equation}
と設定されます．
粒子$i,j$の相互作用についての探索半径$r_{{\rm search},ij}$は，$r_{{\rm search},i}$を用いて式(\ref{rout1}),(\ref{rout2})と同様に設定されます．
%コンパイルオプションで\texttt{-DUSE\_RE\_SEARCH\_NEIGHBOR}が有効になっている場合は，
(\ref{rsearch})の探索半径を用いてネイバー粒子を探索した後，
\begin{eqnarray}
&&\tilde{R}_{\rm  search,2}{r_{{\rm out},ij}} < \left| \bm{r}_{ij}+\bm{v}_{ij}t_{\rm min} \right|,\\
&&t_{\rm min}=
\begin{cases}
0 & \left(-\displaystyle\frac{\bm{r}_{ij}\cdot\bm{v}_{ij}}{{v}_{ij}^2}<0\right) \\
-\displaystyle\frac{\bm{r}_{ij}\cdot\bm{v}_{ij}}{{v_{ij}}^2} & 
\left(0\leq -\displaystyle\frac{\bm{r}_{ij}\cdot\bm{v}_{ij}}{{v_{ij}}^2}<\Delta t\right)\\
\Delta t & \left(\Delta t\leq -\displaystyle\frac{\bm{r}_{ij}\cdot\bm{v}_{ij}}{{v_{ij}}^2}\right)
\end{cases}
\end{eqnarray}
かつ，
\begin{eqnarray}
v_{ij} \geq \tilde{R}_{\rm  search,3}a_{ij}\frac{\Delta t}{2}
\end{eqnarray}
の条件を満たす粒子$j$は粒子$i$のネイバーリストから除かれます．
$\bm{r}_{ij},\ \bm{v}_{ij},\ \bm{a}_{ij}$はそれぞれ粒子$j$に対する粒子$i$の相対位置，相対速度，相対加速度です．

粒子のランダム速度$v_{{\rm ran},i}$は，デフォルトでは，
\begin{equation}
%v_{\rm ran}=\sqrt{\langle e^{2}\rangle + \langle i^{2}\rangle} v_{\rm Kep}
v^{*}_{{\rm ran},j}=\left|\bm{v}_{j}-\bm{v}_{{\rm Kep},j}\right|\label{vran}
\end{equation}
を基準に，中心星からの距離が粒子$i$と近い粒子についての$v*_{{\rm ran},i}$の平均を設定します．
$\bm{v}_{{\rm Kep},j}$は$j$粒子のいる位置でのKepler速度です．
コンパイルオプションで\texttt{isotropic}がyesになっている場合は，(\ref{vran})の代わりに，
\begin{equation}
v^{*}_{{\rm ran},j}=\sqrt{\langle |\bm{v}_{j}|^{2}\rangle-|\langle \bm{v}\rangle|^{2}}
\end{equation}
を用います．

\item[\texttt{gamma}:]
粒子の外側カットオフ半径，内側カットオフ半径の比$\gamma=r_{\rm in}/r_{\rm out}$\ (0.1)．
\item[\texttt{r\_max}:]
リング領域の外側境界$r_{\rm max}$\ (40)．粒子と中心星の距離がこの距離より大きくなったらその粒子を削除します．
\item[\texttt{r\_min}:]
リング領域の外側境界$r_{\rm min}$\ (0.1)．粒子と中心星の距離がこの距離より小さくなったらその粒子を削除します．
\end{description}

\subsection{衝突・破壊}
\begin{description}
\item[\texttt{f}:]
粒子の半径の膨らまし係数$f$\ (1.0)．
初期条件ファイルから初期条件を読み込まない場合，初期条件ファイルの$f$が0に設定されている場合に，この膨らまし係数を用います．
\item[\texttt{R\_merge}:]
連微惑星の形成の判定のためのパラメータ$\tilde{R}_{\rm merge}$\ (0.2)．
コンパイルオプションで\texttt{-DMERGE\_BINARY}が有効になっていない場合は使用されません．
コンパイルオプションで\texttt{-DMERGE\_BINARY}が有効になっている場合は，2粒子$i,\ j$が，
\begin{equation}
r_{ij} < \tilde{R}_{\rm merge}r_{{\rm Hill},ij}
\end{equation}
を満たし，かつ，2粒子のJacobiエネルギーが負の場合に，2粒子をまとめて1つの粒子に置き換えます．
$r_{{\rm Hill},ij}$は粒子$i\ ,j$の相互Hill半径です．
\end{description}

その他，\texttt{collisionB.h}で定義される Collisionクラスで設定されるパラメータもパラメータファイルから読み込むことができます．詳細は．Section \ref{collision}を参照してください．


\section{出力ファイル\label{output}}

出力ディレクトリには，\texttt{snap}$N$\texttt{.dat}と，
\texttt{collision}$N$\texttt{.dat}，\texttt{remove}$N$\texttt{.dat}，\texttt{snap\_tmp.dat}
\texttt{energy.dat}，\texttt{param.dat}が出力されます．
$N$には6桁の整数が0から入ります．

\subsection{\texttt{snap}$N$\texttt{.dat}\label{snap}}
スナップショットファイル\texttt{snap}$N$\texttt{.dat}の形式は，
1行目がヘッダー，2行目からが各粒子の情報です．
ヘッダーには，系の情報が以下の順に出力されます．
\[
t\quad n\quad {\rm ID}_{\rm MAX}\quad E_{\rm tot,init}\quad E_{\rm kin,init}\quad E_{\rm sun,init}\quad E_{\rm planet,init}\quad \Delta E_{\rm init}
\quad E_{\rm tot,now}\quad E_{\rm kin,now}\quad E_{\rm sun,now}\quad E_{\rm planet,now}\quad \Delta E_{\rm now}
\]
$t$は系の時刻，$n$は粒子数，${\rm ID}_{\rm MAX}$は粒子IDの最大値，$E_{\rm tot},E_{\rm kin},E_{\rm sun}, E_{\rm planet},\Delta E$はそれぞれ全力学的エネルギー，運動エネルギー，中心星重力ポテンシャルエネルギー，粒子間相互作用ポテンシャルエネルギー，衝突やガス抵抗，粒子の消去に伴う力学的エネルギー変化で，init,nowはそれぞれ初期と時刻$t$における値を表します．$E_{\rm tot} = E_{\rm kin} + E_{\rm sun} + E_{\rm planet}$となり，理論的には$E_{\rm tot}-\Delta E$が保存量になります．

2行目からの各粒子の情報は以下の順に出力されます．
\[
{\rm ID}\quad m\quad r_{\rm p}\quad f\quad x\quad y\quad z\quad v_{x}\quad v_{y} \quad v_{z}\quad n_{\rm neighbor} \quad {\rm flag}
\]
IDは粒子ID，$m,\ r_{\rm p},\ f$はそれぞれ粒子の質量，半径，半径の膨らまし係数，
$\bm{r}=(x,y,z)$は粒子の位置，$\bm{v}=(v_{x},v_{y},v_{z})$は粒子の速度，$n_{\rm neighbor}$は粒子の近傍粒子数です．
flagは粒子の状態を表すフラグで，粒子が連微惑星をまとめた超粒子かどうかの真偽を1の位で表す2進数の値を10進数で表したものです．


初期条件ファイルも，スナップショットファイルと同じ形式で記述してください．
ただし，初期条件ファイルの$n_{\rm neighbor}$は，計算には使用されません．
粒子半径，半径の膨らまし係数をプログラム内で計算する場合は，初期条件ファイルでは0を設定してください．
初期条件で同じ粒子IDを持つ粒子が複数存在する場合は，正しい動作が保証されません．

パラメータ\texttt{Header}が1の場合は，初期条件ファイルのヘッダーから
%$t,\ E_{\rm tot,init},\ E_{\rm kin,init},\ E_{\rm sun,init},\ E_{\rm planet,init},\ \Delta E_{\rm init}$
エネルギーなどの情報を読み込み，それらを使用します．
パラメータ\texttt{Header}が0の場合は，1行目から粒子の情報を読み込みます．この場合は，$t=0,\ \Delta E_{\rm init}=0.0$と設定し，ヘッダーの情報は初期条件から計算されます．
%$E_{\rm tot,init},\ E_{\rm kin,init},\ E_{\rm sun,init},\ E_{\rm planet,init}$は初期条件から計算された値を設定します．
初期条件ファイルのヘッダー情報を使用しない場合は，初期条件ファイルのヘッダーの行を削除し，\texttt{Header}を0として初期条件を読み込んでください．
%初期条件ファイルからヘッダー情報を読み込んだ場合，

計算途中で衝突破壊などで新しい粒子が生成される場合は，粒子IDは${\rm ID}_{\rm MAX}+1$から順に設定されます．

スナップショットファイルに出力する粒子情報，初期条件ファイルから読み込む粒子情報は，それぞれ\texttt{particle.h}のFPGrav::writeAscii 関数，FPGrav::readAscii 関数を書き換えることで変更できます．
%ただし，計算を再スタートするためには，FPGrav::writeAscii 関数で書き出す情報とFPGrav::readAscii 関数で読み込む情報の形式が一致している必要があります．

\subsection{\texttt{collision}$N$\texttt{.dat}}

\texttt{collision}$N$\texttt{.dat}には，
\texttt{snap}$(N-1)$\texttt{.dat}の時刻から\texttt{snap}$N$\texttt{.dat}の時刻までの間の時間に起こった衝突について，情報が以下の順に出力されます．
\[
t\quad {\rm ID}_{\rm imp}\quad {\rm ID}_{\rm tar}\quad n_{\rm frag}\quad {\rm ID}_{\rm frag}\quad m_{\rm imp}\quad m_{\rm tar}\quad m_{\rm frag} \quad r_{\rm imp} \quad v_{\rm imp} \quad \theta_{\rm imp} \quad {\rm flag}\quad |\Delta \bm{r}_{\rm g}|/|\bm{r}_{\rm g}| \quad |\Delta \bm{v}_{\rm g}|/|\bm{v}_{\rm g}|
\]
$t$は衝突が起こった時刻，${\rm ID},\ m$はそれぞれ粒子のIDと質量で，imp, tarはそれぞれインパクター粒子，ターゲット粒子を表します．衝突する2粒子のうち，質量が小さい方をインパクター粒子，大きい方をターゲット粒子としています．
$n_{\rm frag},\ {\rm ID}_{\rm frag},\ m_{\rm frag}$はそれぞれ衝突で生じる破片粒子数，1つ目の破片粒子のID，破片粒子の総質量で，この衝突により生じる破片粒子のIDは${\rm ID}_{\rm frag}$から${\rm ID}_{\rm frag}+n_{\rm frag}-1$までとなります．
$r_{\rm imp},\ v_{\rm imp},\ \theta_{\rm imp}$はターゲット粒子に対するインパクター粒子の相対距離，相対速度，衝突角です．
flagは衝突の状態を表すフラグで，衝突後にインパクター粒子とターゲット粒子が合体するかどうかの真偽を1の位で，インパクター粒子が連微惑星をまとめた超粒子かどうかの真偽を2の位で，ターゲット粒子が連微惑星をまとめた超粒子かどうかの真偽を4の位で表す2進数の値を10進数で表したものです．
$ \bm{r}_{\rm g},\ \bm{v}_{\rm g}$はそれぞれインパクター粒子，ターゲット粒子，破片粒子の系の重心位置，重心速度で，$\Delta \bm{r}_{\rm g},\ \Delta \bm{v}_{\rm g}$はそれらの衝突前と衝突後の差です．

\texttt{collision.dat}に出力する情報は，\texttt{collisionA.h}のCollision0::write2File関数を書き換えるか，
\texttt{collisionB.h}のCollisionクラスでwrite2Fileをオーバーライドして書き換えることで変更できます．
衝突モデルの変更の方法についてはSection \ref{collision}を参照ください．



\subsection{\texttt{remove}$N$\texttt{.dat}}

\texttt{remove}$N$\texttt{.dat}には，
\texttt{snap}$(N-1)$\texttt{.dat}の時刻から\texttt{snap}$N$\texttt{.dat}の時刻までの間の時間に
削除された粒子の情報が以下の順に出力されます．
\[
t\quad {\rm ID}\quad m \quad x\quad y\quad z\quad v_{x}\quad v_{y} \quad v_{z}
\]
$t$は粒子が削除された時刻，
IDは粒子ID，$m$は粒子の質量，$\bm{r}_{i}=(x,y,z)$は粒子の位置，$\bm{v}_{i}=(v_{x},v_{y},v_{z})$は粒子の速度です．

%粒子の削除は，1ステップに最大1粒子しか行われません．

\subsection{\texttt{energy.dat}\label{outputene}}

\texttt{energy.dat}には，スナップショットファイルを出力するごとに系の情報が以下の順に出力されます．
\[
t\quad n\quad E_{\rm tot,now}\quad (E_{\rm tot, now}-E_{\rm tot, init}-\Delta E_{\rm now})/E_{\rm tot, init}\quad n_{\rm large cluater}\quad n_{\rm cluster}\quad n_{\rm iso particle}
\]
$n_{\rm large cluster},\ n_{\rm cluster},\ n_{\rm iso particle}$は，直前の1ステップの最大のクラスターの粒子数，クラスター数，近接粒子を持たない粒子数です．

%マクロ\texttt{OUTPUT\_DETAIL}
Makefileで\texttt{output\_detail}がyesになっている場合は，この後に，最大質量，平均質量，平均近接粒子数も出力されます．

\subsection{\texttt{snap\_tmp.dat}}
\texttt{snap\_tmp.dat}には，再計算に使用するための粒子の情報がバイナリ形式で出力されます．


\subsection{\texttt{param.dat}}

\texttt{param.dat}には，設定されたパラメータが出力されます．
計算を再スタートすると，その度にその計算で設定されたパラメータが書き加えられます．


\section{衝突合体/破壊モデルの変更\label{collision}}

衝突合体/破壊モデルは，\texttt{collisionB.h}のCollisionクラスで設定できます．
Collisionクラスは．\texttt{collisionA.h}のCollision0クラスを継承しています．
現在は，サンプルとして\texttt{collisionB.h}には完全合体モデル，Kominami et al. (in prep.)，Chambers (2013)の衝突破壊モデルに対応するCollisionクラスが記述されています．

Collisionクラスには以下のメンバ関数を設定してください．
基本的に，これらのメンバ関数を変更するか新しく記述することで衝突合体/破壊モデルを変更します．
\subsection{Collision::collisionOutcome}

\begin{screen}
\begin{verbatim}
template <class Tp>
PS::S32 Collision::collisionOutcome(std::vector<Tp> & pfrag)
\end{verbatim}
\end{screen}

\begin{description}
\item[引数]

\texttt{pfrag}:\ 出力．std::vector<Tp>型．衝突により生じる破片粒子のリスト．Tpは\texttt{particle.h}のFPHardクラスを想定しています．

\item[返値]

PS::S32型．衝突により生じる破片粒子数．

\item[機能]

以下のメンバ変数(入力)の値を用いて，メンバ変数(出力)の値を設定します．${}^{*}$が付いているものは，設定しなくても自動で設定されるメンバ変数です．
\begin{itemize}

\item
メンバ変数(入力)\\
\texttt{pos\_imp}:\ PS::F64vec型．衝突直前のインパクター粒子の位置．

\texttt{pos\_tar}:\ PS::F64vec型．衝突直前のターゲット粒子の位置．

\texttt{pos\_g}:\ PS::F64vec型．衝突直前のインパクター粒子，ターゲット粒子の重心位置．

\texttt{vel\_imp}:\ PS::F64vec型．衝突直前のインパクター粒子の速度．

\texttt{vel\_tar}:\ PS::F64vec型．衝突直前のターゲット粒子の速度．

\texttt{vel\_g}:\ PS::F64vec型．衝突直前のインパクター粒子，ターゲット粒子の重心速度．

\texttt{mass\_imp}:\ PS::F64型．衝突直前のインパクター粒子の質量．

\texttt{mass\_tar}:\ PS::F64型．衝突直前のターゲット粒子の質量．

\texttt{col\_angle}:\ PS::F64型．衝突角．

\texttt{r\_planet\_imp}:\ PS::F64型．衝突直前のインパクター粒子の半径．

\texttt{r\_planet\_tar}:\ PS::F64型．衝突直前のターゲット粒子の半径．

\texttt{f\_imp}:\ PS::F64型．衝突直前のインパクター粒子の半径の膨らまし係数．

\texttt{f\_tar}:\ PS::F64型．衝突直前のターゲット粒子の半径の膨らまし係数．

\texttt{imp\_is\_binary}:\ bool型．衝突直前にインパクターが連微惑星をまとめた超粒子であるかどうかの真偽．コンパイルオプションで\texttt{-DMERGE\_BINARY}が有効になっていない場合は定義されません．

\texttt{imp\_is\_binary}:\ bool型．衝突直前にインパクターが連微惑星をまとめた超粒子であるかどうかの真偽．コンパイルオプションで\texttt{-DMERGE\_BINARY}が有効になっていない場合は定義されません．
\\

\item
メンバ変数(出力)\\
\texttt{pos\_imp\_new}:\ PS::F64vec型．衝突直後のインパクター粒子の位置．

\texttt{pos\_tar\_new}:\ PS::F64vec型．衝突直後のターゲット粒子の位置．

\texttt{vel\_imp\_new}:\ PS::F64vec型．衝突直後のインパクター粒子の速度．

\texttt{vel\_tar\_new}:\ PS::F64vec型．衝突直後のターゲット粒子の速度．

\texttt{mass\_frag}:\ PS::F64型．破片粒子の総質量．

\texttt{n\_frag}:\ PS::S32型．破片粒子数．

\texttt{flag\_merge}:\ PS::S32型．衝突後にインパクター粒子とターゲット粒子が合体する場合に1，合体せずヒットアンドラン衝突となる場合に0．2以上の値は設定しないでください．

\texttt{r\_planet\_imp\_new}${}^{*}$:\ PS::F64型．衝突直後のインパクター粒子の半径．設定されない場合は，衝突前後でインパクター粒子の平均密度が保存されるように半径が設定されます．

\texttt{r\_planet\_tar\_new}${}^{*}$:\ PS::F64型．衝突直後のターゲット粒子の半径．設定されない場合は，衝突前後でターゲット粒子の平均密度が保存されるように半径が設定されます．

\texttt{f\_imp\_new}${}^{*}$:\ PS::F64型．衝突直後のインパクター粒子の半径の膨らまし係数．設定されない場合は，衝突直前の値が代入されます．

\texttt{f\_tar\_new}${}^{*}$:\ PS::F64型．衝突直後のターゲット粒子の半径の膨らまし係数．設定されない場合は，衝突直前の値が代入されます．

\texttt{imp\_will\_be\_binary}${}^{*}$:\ bool型．衝突直後にインパクターが連微惑星をまとめた超粒子であるかどうかの真偽．コンパイルオプションで\texttt{merge\_binary}がyesになっていない場合は定義されません．設定されない場合は，衝突直前の値が代入されます．

\texttt{imp\_will\_be\_binary}${}^{*}$:\ bool型．衝突直後にインパクターが連微惑星をまとめた超粒子であるかどうかの真偽．コンパイルオプションで\texttt{merge\_binary}がyesになっていない場合は定義されません．設定されない場合は，衝突直前の値が代入されます．
\\

\end{itemize}

また，生じた破片粒子のリストをstd::vector<Tp>型で作り，引数の\texttt{pfrag}に代入します．
破片粒子の半径は，設定されなければ質量とパラメータファイルで設定した粒子平均密度から計算され，半径の膨らまし係数は，設定されなければインパクター粒子の半径の膨らまし係数が代入されます．
破片粒子が生じない場合は，\texttt{mass\_frag}と\texttt{n\_frag}を0にし，\texttt{pfrag}のサイズを0にします．

インパクター粒子とターゲット粒子が合体しない場合(${\rm flag}=0$の場合)，破片は全てインパクター粒子から生じたものとなります．
インパクター粒子とターゲット粒子が合体する場合(${\rm flag}=1$の場合)，\texttt{pos\_imp\_new}と\texttt{pos\_tar\_new}，\texttt{vel\_imp\_new}と\texttt{vel\_tar\_new}は等しくなければなりません．
インパクター粒子とターゲット粒子が合体する場合は，インパクター粒子は消滅するため，\texttt{r\_planet\_imp\_new}や\texttt{r\_planet\_imp\_new}，\texttt{imp\_will\_be\_binary}の値は後では使われません．

破片粒子数\texttt{n\_frag}を返します．
\end{description}


また，Collisionクラスでパラメータの設定を行う必要がある場合，
必要に応じて，以下のメンバ関数を設定してください．
\subsection{Collision::readParameter}

\begin{screen}
\begin{verbatim}
static void readParameter(std::string name, std::string value)
\end{verbatim}
\end{screen}

\begin{description}
\item[引数]

\texttt{name}:\ 入力．std::string型．パラメータ変数名．

\texttt{value}:\ 入力．std::string型．文字列として読み取ったパラメータ変数の値．

\item[返値]

なし．
\item[機能]

パラメータファイルから読み込んだパラメータ変数名とパラメータ変数名を受け取り，メンバ変数の値を設定します．
\end{description}

\subsection{Collision::showParameter}

\begin{screen}
\begin{verbatim}
static void showParameter(std::ostream & fout = std::cout)
\end{verbatim}
\end{screen}

\begin{description}
\item[引数]

なし．

\item[返値]

なし．
\item[機能]

パラメータの値を出力します．

\end{description}



\section{ライセンス}

MITライセンスに準じます．
\ourcode を使用した結果を発表する場合は，以下の文献の引用をお願いします．
%\footnote{発表する直前に最新の情報を確認してください}．
%\begin{itemize}
%\item[1)] Iwasawa et al. (2016, PASJ, 68, 59)
%\item[2)] Ishigaki (2019, M. Thesis, University of Tokyo) 
%\ または\ 
%\Paper
%\end{itemize}

\begin{itemize}
\item[1)]
%Ishigaki, Y., 2019. Development of N-body simulation code for planetary system formation with particle-particle particle-tree scheme. M. thesis, University of Tokyo.
Ishigaki, Y., Kominami, J., Makino, J., Fujimoto, M., Iwasawa, M., 2021. 
Particle--particle Particle--tree Code for Planetary System Formation with Individual Cut-off Method: GPLUM. Publications of the Astronomical Society of Japan, 73 (3), 660--676.

\item[2)]
Iwasawa, M., Tanikawa, A., Hosono, N., Nitadori, K., Muranushi, T., Makino, J., 2016. Implementation and performance of FDPS: A framework for developing parallel particle simulation codes. Publications of the Astronomical Society of Japan, 68 (4), 54--75.
\end{itemize}

%\begin{quote}
Copyright 2020 Yota Ishigaki, Junko Kominami, Junichiro Makino, Masaki Fujimoto, Masaki Iwasawa

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
%\end{quote}


\section{現在分かっている不具合\label{s:error}}

\begin{itemize}
\item
FDPSのディレクトリ内のPIKGはバージョンが古いため，そちらを使用すると正常にコンパイルされないことがあります．
PIKGは，別途最新版をダンロードしてください．

\item
PIKG-0.1では64bit整数に未対応であるため，SIMD命令を使用すると，正常にコンパイルされないことがあります．
その場合は，\texttt{-DFOR\_PIKG01}を有効にしてコンパイルしてください．

\item
FDPS-7.0では一部のsearch modeで周期境界条件が未対応であるため，領域の極座標分割を使用すると正確に計算されません．
fdps-develのmakinotestブランチでは，\ourcode で使用しているsearch modeで周期境界条件に対応しています．fdps-develにアクセス可能であればこちらを使用してください．

\end{itemize}



\section*{}

不明な点やバグ等あれば，石城(y.ishigaki@stp.isas.jaxa.jp)までご連絡ください．


\end{document}